<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>App Manager</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="refresh-spinner-fix.css">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ccircle cx='8' cy='8' r='7' fill='%233584e4'/%3E%3C/svg%3E">
  <meta name="color-scheme" content="light dark" />
  <!-- Mise √† jour CSP: autoriser les requ√™tes (fetch) vers portable-linux-apps.github.io pour r√©cup√©rer les descriptions -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' appicon: https: data:; style-src 'self' 'unsafe-inline'; script-src 'self'; connect-src 'self' https://portable-linux-apps.github.io;">
</head>
<body>
  <header class="app-header" data-tauri-drag-region>
    <div class="brand">
  <img class="brand-icon" src="app-icon.png" alt="App Manager Icon" aria-hidden="true">
  <div class="brand-title" data-i18n="main.title">App Manager</div>
    </div>
    <div class="header-center" role="search" aria-label="Recherche">
      <div class="search">
        <span class="search-icon" aria-hidden="true">üîç</span>
        <input id="searchInput" type="search" placeholder="Rechercher des applications‚Ä¶" data-i18n-placeholder="search.placeholder" autocomplete="off" />
      </div>
    </div>
    <div class="header-right">
      <div class="global-actions">
  <button id="settingsBtn" class="btn btn-outline btn-settings" title="Param√®tres (Ctrl+,)" aria-haspopup="true" aria-expanded="false" aria-controls="settingsPanel"><span class="gear-icon" aria-hidden="true">‚öô</span></button>
  <div id="settingsPanel" class="settings-panel settings-panel-right" role="dialog" aria-modal="false" aria-label="Param√®tres" hidden tabindex="-1">
          <div class="settings-group">
            <div class="settings-title" data-i18n="settings.theme">Th√®me</div>
            <label><input type="radio" name="themePref" value="system" checked> <span data-i18n="settings.auto">Syst√®me</span></label>
            <label><input type="radio" name="themePref" value="light"> <span data-i18n="settings.light">Clair</span></label>
            <label><input type="radio" name="themePref" value="dark"> <span data-i18n="settings.dark">Sombre</span></label>
          </div>
          <div class="settings-group">
            <div class="settings-title" data-i18n="settings.lang">Langue</div>
            <label><input type="radio" name="langPref" value="auto" checked> <span data-i18n="settings.auto">Auto</span></label>
            <label><input type="radio" name="langPref" value="fr"> <span data-i18n="settings.fr">Fran√ßais</span></label>
            <label><input type="radio" name="langPref" value="en"> <span data-i18n="settings.en">English</span></label>
            <label><input type="radio" name="langPref" value="it"> <span data-i18n="settings.it">Italiano</span></label>
          </div>
          <div class="settings-group">
            <div class="settings-title" data-i18n="settings.links">Liens</div>
            <label style="font-size:13px;"><input type="checkbox" id="openExternalLinksCheckbox"> <span data-i18n="settings.openExternal">Ouvrir les liens dans le navigateur externe</span></label>
          </div>
          <div class="settings-group">
            <div class="settings-title" data-i18n="settings.gpuTitle">Acc√©l√©ration GPU</div>
            <label style="font-size:13px;"><input type="checkbox" id="disableGpuCheckbox"> <span data-i18n="settings.gpuLabel">D√©sactiver l'acc√©l√©ration GPU (pour corriger les bugs graphiques)</span></label>
          </div>
          <div class="settings-separator"></div>
          <div class="settings-group">
            <div class="settings-title" data-i18n="settings.coming">√Ä venir</div>
            <div style="font-size:12px; opacity:.7; line-height:1.4;" data-i18n="settings.future">De nouvelles options seront ajout√©es ici prochainement.</div>
            <div style="margin-top:10px; display:flex; flex-direction:column; gap:6px;">
              <button id="purgeIconsBtn" class="mini-btn" type="button" style="align-self:flex-start; font-size:12px; padding:6px 10px; border:1px solid var(--border); background:var(--card); border-radius:8px; cursor:pointer;" data-i18n="settings.purge">Vider le cache des ic√¥nes</button>
              <div id="purgeIconsResult" style="font-size:11px; opacity:.65;"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="window-buttons" aria-label="Fen√™tre">
    <button class="win-btn" data-action="min" title="R√©duire" data-i18n-title="window.min">‚Äì</button>
    <button class="win-btn" data-action="max" title="Maximiser / Restaurer" data-i18n-title="window.max">‚¨ú</button>
    <button class="win-btn win-close" data-action="close" title="Fermer" data-i18n-title="window.close">√ó</button>
      </div>
    </div>
  </header>
  <div class="sub-bar" role="toolbar" aria-label="Navigation des onglets">
    <div class="tabs-row">
      <nav class="tabs" role="tablist" aria-label="Cat√©gories">
        <button class="tab active" role="tab" aria-selected="true" data-category="all" data-i18n="tabs.all">Tout</button>
        <button class="tab" role="tab" aria-selected="false" data-category="installed"><span data-i18n="tabs.installed">Install√©es</span> <span id="installedCount" class="badge">0</span></button>
        <button class="tab" role="tab" aria-selected="false" data-category="updates" data-i18n="tabs.updates">Mises √† jour</button>
        <button class="tab" role="tab" aria-selected="false" data-category="advanced" data-i18n="tabs.advanced">Mode avanc√©</button>
      </nav>
      <div class="view-mode-switch" role="group" aria-label="Mode d'affichage">
        <button id="refreshBtn" class="btn btn-outline btn-refresh" title="Rafra√Æchir la liste" aria-label="Rafra√Æchir" data-i18n-title="refresh.title" data-i18n-aria-label="refresh.aria">‚Üª</button>
        <button id="modeMenuBtn" class="btn btn-outline" aria-haspopup="true" aria-expanded="false" aria-controls="modeMenu" title="Changer de mode d'affichage" data-i18n-title="modeMenu.title">‚ñ¶</button>
        <div id="modeMenu" class="mode-menu" role="menu" hidden>
          <button class="mode-option" data-mode="grid" role="menuitem" aria-pressed="true" data-i18n="modeMenu.grid">‚ñ¶ Grille</button>
          <button class="mode-option" data-mode="list" role="menuitem" aria-pressed="false" data-i18n="modeMenu.list">‚â£ Liste</button>
          <button class="mode-option" data-mode="icons" role="menuitem" aria-pressed="false" data-i18n="modeMenu.icons">‚óªÔ∏é Ic√¥nes</button>
          <button class="mode-option" data-mode="cards" role="menuitem" aria-pressed="false" data-i18n="modeMenu.cards">üÇ† Cartes</button>
        </div>
      </div>
    </div>
  </div>
  <div class="scroll-shell">
    <main class="content" id="mainContent">
      <!-- Updates panel moved to top to avoid big blank space when apps list hidden -->
      <section id="updatesPanel" class="panel-lite updates-panel" hidden>
    <h2 class="panel-heading-xl" data-i18n="updates.title">Mettre √† jour AM et toutes les applications install√©es</h2>
        <div class="updates-actions-row">
          <button id="runUpdatesBtn" class="btn btn-primary updates-run" data-i18n="updates.run">Mettre √† jour</button>
        </div>
        <div id="updateSpinner" class="update-spinner" role="status" aria-live="polite" hidden>
          <div class="spinner" aria-hidden="true"></div>
          <div class="spinner-label" data-i18n="updates.loading">Recherche de mises √† jour et installation si n√©cessaire‚Ä¶</div>
        </div>
        <div id="updateResult" class="update-result" style="display:none;">
          <div id="updateFinalMessage" class="update-final-message"></div>
          <div id="updatedAppsIcons" class="icons-row updated-icons"></div>
          <div class="raw-link-row">
            <button id="showRawUpdateBtn" class="mini-btn-link" type="button" data-i18n="updates.details">Voir les d√©tails‚Ä¶</button>
          </div>
        </div>
      </section>
      <section id="advancedPanel" class="panel-lite advanced-panel" hidden>
    <h2 class="panel-heading-sm" data-i18n="advanced.title">Mode avanc√©</h2>
    <p class="placeholder-strong"><span data-i18n="advanced.waiting">Fonctions avanc√©es encore non disponibles dans l‚ÄôUI ‚Äî utilisez le terminal : am -h pour la liste compl√®te des commandes.</span></p>

    <ul class="commands condensed" aria-label="Commandes AM">
      <li><code>am -h</code> ‚Äî <span data-i18n="advanced.cmd.help">aide</span></li>
      <li><code>am -l</code> ‚Äî <span data-i18n="advanced.cmd.list">lister les apps disponibles</span></li>
      <li><code>am -a &lt;PROGRAM&gt;</code> ‚Äî <span data-i18n="advanced.cmd.about">informations sur l'app</span></li>
      <li><code>am -i &lt;PROGRAM&gt;</code> ‚Äî <span data-i18n="advanced.cmd.install">installer (ajouter --user pour local)</span></li>
      <li><code>am -q &lt;mot-cl√©&gt;</code> ‚Äî <span data-i18n="advanced.cmd.query">rechercher</span></li>
      <li><code>am -u</code> ‚Äî <span data-i18n="advanced.cmd.update">mettre √† jour (ou am -u &lt;PROGRAM&gt;)</span></li>
      <li><code>am -s</code> ‚Äî <span data-i18n="advanced.cmd.updatemodules">mettre √† jour AM/modules</span></li>
      <li><code>am -R &lt;PROGRAM&gt;</code> ‚Äî <span data-i18n="advanced.cmd.remove">supprimer</span></li>
      <li><code>am -e &lt;git-url&gt; &lt;appname&gt; [keyword]</code> ‚Äî <span data-i18n="advanced.cmd.extra">installer depuis GitHub</span></li>
      <li><code>am translate</code> ‚Äî <span data-i18n="advanced.cmd.translate">g√©rer traductions</span></li>
    </ul>

    <p class="note"><em><span data-i18n="advanced.note.appman">Pour la version sans privil√®ges, remplacez <code>am</code> par <code>appman</code>.</span></em></p>

    <p class="docs-link"><a href="https://github.com/ivan-hc/AM" target="_blank" rel="noopener"><span data-i18n="advanced.docs">Documentation compl√®te & guides ‚Üí</span> AM (GitHub)</a></p>
      </section>
      <div id="apps" class="app-list" aria-live="polite" aria-busy="true"></div>
      <section id="appDetails" class="app-details" hidden>
    <button id="backToListBtn" class="btn btn-outline back-btn" data-i18n="details.back">‚Üê Retour</button>
        <div class="details-header">
          <img id="detailsIcon" alt="Ic√¥ne" />
          <div class="details-head-text">
            <h2 id="detailsName"></h2>
          </div>
        </div>
        <div class="details-actions">
          <button id="detailsInstallBtn" class="btn btn-primary" data-i18n="details.install">Installer</button>
          <button id="detailsForceCancelBtn" class="btn btn-outline danger" title="Forcer l'annulation" aria-label="Forcer l'annulation" hidden style="padding:6px 10px;">‚úï</button>
          <button id="detailsUninstallBtn" class="btn btn-outline" data-i18n="details.uninstall">D√©sinstaller</button>
        </div>
        <div id="installStream" class="install-stream" hidden>
          <div class="install-stream-head">
            <div class="install-stream-meta">
              <span id="installStreamElapsed">0s</span>
            </div>
            <div class="install-stream-progressbar-wrapper" style="width:100%;margin-top:8px;">
              <span id="installStreamProgressPercent" style="margin-right:10px;font-weight:bold;font-size:13px;"></span>
              <progress id="installStreamProgressBar" value="0" max="100" style="vertical-align:middle;width:160px;height:14px;"></progress>
              <span id="installStreamEta" style="margin-left:12px;font-size:13px;color:var(--muted);"></span>
            </div>
          </div>
        </div>
        <div class="details-long-wrapper">
          <h3 class="details-section-title" data-i18n="details.desc">Description</h3>
          <p id="detailsLong" class="details-long"></p>
        </div>
        <div id="detailsGallery" class="details-gallery" hidden>
          <h3 class="details-gallery-title" data-i18n="details.captures">Captures</h3>
          <div id="detailsGalleryInner" class="gallery-row"></div>
        </div>
      </section>
    </main>
    <div id="toast" class="toast" role="status" aria-live="polite" hidden></div>
  </div>

  <!-- Lightbox pour les captures -->
  <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Aper√ßu de la capture" hidden>
  <button id="lightboxClose" class="lightbox-close" aria-label="Fermer" data-i18n-aria-label="lightbox.close">‚úï</button>
  <button id="lightboxPrev" class="lightbox-nav prev" aria-label="Pr√©c√©dente" data-i18n-aria-label="lightbox.prev">‚Äπ</button>
    <figure class="lightbox-figure">
      <img id="lightboxImage" alt="Capture" />
      <figcaption id="lightboxCaption" class="lightbox-caption"></figcaption>
    </figure>
    <button id="lightboxNext" class="lightbox-nav next" aria-label="Suivante">‚Ä∫</button>
  <button id="lightboxNext" class="lightbox-nav next" aria-label="Suivante" data-i18n-aria-label="lightbox.next">‚Ä∫</button>
  </div>

  <!-- Modale sortie brute mises √† jour -->
  <div id="rawUpdateModal" class="modal" role="dialog" aria-modal="true" aria-label="Sortie de la mise √† jour" hidden>
    <div class="modal-dialog">
      <div class="modal-header">
    <h3 class="modal-title" data-i18n="modal.updateTitle">D√©tails de la mise √† jour</h3>
    <button id="rawUpdateClose" class="modal-close" aria-label="Fermer" data-i18n-aria-label="modal.close">‚úï</button>
      </div>
      <div class="modal-body">
        <pre id="rawUpdatePre" class="raw-pre" aria-label="Sortie brute" tabindex="0"></pre>
      </div>
      <div class="modal-footer">
    <button id="rawCopyBtn" class="mini-btn" type="button" data-i18n="modal.copy">Copier</button>
    <button id="rawSaveBtn" class="mini-btn" type="button" data-i18n="modal.save">Enregistrer‚Ä¶</button>
    <div class="grow"></div>
    <button id="rawUpdateClose2" class="btn btn-outline" type="button" data-i18n="modal.closeBtn">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Modale confirmation compacte (sans titre ni croix) -->
  <div id="actionConfirmModal" class="modal" role="dialog" aria-modal="true" aria-label="Confirmation" hidden>
    <div class="modal-dialog confirm-dialog" role="document">
      <div class="confirm-body">
        <p id="actionConfirmMessage" class="confirm-message"></p>
        <div class="confirm-actions">
          <button id="actionConfirmCancel" class="btn btn-soft-neutral" type="button" data-i18n="confirm.cancel">Annuler</button>
          <button id="actionConfirmOk" class="btn" type="button" data-i18n="confirm.ok">Valider</button>
        </div>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
  <!-- Modale choix installation multiple -->
  <div id="multiChoiceModal" class="modal" role="dialog" aria-modal="true" aria-label="Choix d'installation" hidden>
    <div class="modal-dialog">
      <div class="modal-header">
        <h3 class="modal-title">Choisissez une variante √† installer</h3>
        <button id="multiChoiceClose" class="modal-close" aria-label="Fermer">‚úï</button>
      </div>
      <div class="modal-body">
        <div id="multiChoiceList" class="multi-choice-list"></div>
      </div>
      <div class="modal-footer">
        <button id="multiChoiceCancel" class="btn btn-soft-neutral" type="button">Annuler</button>
      </div>
    </div>
  </div>
</body>
